generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum Plan {
  FREE
  PAID
}

enum SubmissionStatus {
  DRAFT
  SCORED
  UNDER_REVIEW
  COMPLETED
}

model User {
  id             String              @id @default(cuid())
  name           String?
  email          String              @unique
  passwordHash   String
  role           Role                @default(USER)
  plan           Plan                @default(FREE)
  credits        Int                 @default(1)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  accounts       Account[]
  sessions       Session[]
  submissions    Submission[]
  creditActivity CreditTransaction[]
}

model Submission {
  id                   String           @id @default(cuid())
  userId               String
  status               SubmissionStatus @default(DRAFT)
  ideaTitle            String
  problemStatement     String
  targetCustomer       String
  geography            String
  industry             String
  businessModel        String
  marketValidation     String
  competitionDensity   String
  differentiation      String
  founderExperience    String
  teamComposition      String
  availableBudget      String
  mvpComplexity        String
  marketingPlan        String
  pricingClarity       String
  retentionPotential   String
  monetizationTimeline String
  technicalAdvantage   String
  legalRisk            String
  goToMarketReadiness  String
  urgencyLevel         String
  notes                String?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  user                 User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  score                Score?
}

model Score {
  id                  String   @id @default(cuid())
  submissionId        String   @unique
  total               Int
  riskTier            String
  marketDemand        Int
  competition         Int
  scalability         Int
  founderFit          Int
  capitalFeasibility  Int
  executionMarketing  Int
  pillarSummary       Json
  pivotSuggestions    Json
  expertNotes         String?
  reportPdfUrl        String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  submission          Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
}

model CreditTransaction {
  id          String   @id @default(cuid())
  userId      String
  change      Int
  reason      String
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?
  access_token       String?
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
